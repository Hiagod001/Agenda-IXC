<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Uai Telecom - Sistema de Agenda</title>
<link href="style.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
</head>
<body>
<!-- Loading Screen -->
<div class="loading-screen" id="loadingScreen">
<div class="loading-content">
<img alt="Uai Telecom" class="loading-logo" src="logo.png"/>
<div class="loading-spinner">
<div class="spinner"></div>
</div>
<p>Carregando sistema...</p>
</div>
</div>
<!-- Header -->
<header class="header">
<div class="header-content">
<div class="header-left">
<button class="menu-toggle" onclick="toggleSidebar()">
<i class="fas fa-bars"></i>
</button>
<img alt="Uai Telecom" class="header-logo" src="logo.png"/>
<h1>Sistema de Agenda</h1>
</div>
<div class="header-right">
<!-- BOTÃO DO MODO NOTURNO ADICIONADO AQUI -->

<div class="user-info">
<span class="user-name" id="userName">Carregando...</span>
<div class="user-menu">
<button class="user-button" onclick="toggleUserMenu()">
<i class="fas fa-user-circle"></i>
</button>
<div class="user-dropdown" id="userDropdown">
<a href="#" onclick="showProfile()">
<i class="fas fa-user"></i> Perfil
                            </a>
<a href="#" onclick="showSettings()">
<i class="fas fa-cog"></i> Configurações
                            </a>
<hr/>
<a href="/logout">
<i class="fas fa-sign-out-alt"></i> Sair
                            </a>
</div>
</div>
</div>
</div>
</div>
</header>
<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
<nav class="sidebar-nav">
<ul class="nav-list">
<li class="nav-item active">
<a class="nav-link" href="#" onclick="showSection('dashboard')">
<i class="fas fa-tachometer-alt"></i>
<span>Dashboard</span>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="agenda-dashboard.html">
<i class="fas fa-calendar-check"></i>
<span>Dashboard de Agenda</span>
</a>
</li>
<li class="nav-item permission-only" data-permission="agenda.create" style="display:none;">
  <a class="nav-link" href="novo-agendamento.html">
    <i class="fas fa-plus-circle"></i>
    <span>Novo Agendamento</span>
  </a>
</li>

<li class="nav-item">
<a class="nav-link" href="#" onclick="showSection('vagas')">
<i class="fas fa-clock"></i>
<span>Consultar Vagas</span>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" onclick="showSection('relatorios')">
<i class="fas fa-chart-bar"></i>
<span>Relatórios</span>
</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="#" onclick="showSection('auditoria')">
    <i class="fas fa-user-shield"></i>
    <span>Auditoria</span>
  </a>
</li>
<li class="nav-item permission-only" data-permission="vagas.manage" style="display:none;">
<a class="nav-link" href="#" onclick="showSection('gerenciarVagas')">
<i class="fas fa-sliders-h"></i>
<span>Gerenciar Vagas</span>
</a>
</li>
<li class="nav-item permission-only" data-permission="subjects.manage" style="display:none;">
<a class="nav-link" href="#" onclick="showSection('assuntos')">
<i class="fas fa-tags"></i>
<span>Gerenciar Assuntos</span>
</a>
</li>

<li class="nav-item permission-only" data-permission="technicians.manage" style="display:none;">
  <a class="nav-link" href="gerenciar-tecnicos.html">
	    <i class="fas fa-hard-hat"></i>
    <span>Gerenciar Técnicos</span>
  </a>
</li>

<li class="nav-item permission-only" data-permission="cities.manage" style="display:none;">
  <a class="nav-link" href="gerenciar-cidades.html">
    <i class="fas fa-city"></i>
    <span>Gerenciar Cidades</span>
  </a>
</li>

<li class="nav-item permission-only" data-permission="config.view" style="display:none;">
  <a class="nav-link" href="config-ixc.html">
    <i class="fas fa-cog"></i>
    <span>Configurar API IXC</span>
  </a>
</li>
<li class="nav-item admin-only" style="display: none;">
<a class="nav-link" href="gerenciar-usuarios.html">
<i class="fas fa-users-cog"></i>
<span>Gerenciar Usuários</span>
</a>
</li>
</ul>
</nav>
</aside>
<!-- Main Content -->
<main class="main-content">
<!-- Dashboard Section -->
<section class="content-section active" id="dashboard">
<div class="section-header">
<h2>Dashboard</h2>
<p>Visão geral do sistema de agendamentos</p>
</div>
<div class="stats-grid">
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-calendar-check"></i></div>
<div class="stat-content">
<h3 id="totalAgendamentos">0</h3>
<p>Total de Agendamentos</p>
</div>
</div>
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-clock"></i></div>
<div class="stat-content">
<h3 id="agendamentosHoje">0</h3>
<p>Agendamentos Hoje</p>
</div>
</div>
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-check-circle"></i></div>
<div class="stat-content">
<h3 id="agendamentosConcluidos">0</h3>
<p>Concluídos</p>
</div>
</div>
<div class="stat-card">
<div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
<div class="stat-content">
<h3 id="agendamentosPendentes">0</h3>
<p>Pendentes</p>
</div>
</div>
</div>
<div class="dashboard-content">
<div class="recent-appointments">
<h3>Agendamentos Recentes</h3>
<div class="appointments-list" id="recentAppointments">
<!-- Será preenchido via JavaScript -->
</div>
</div>
</div>

<div class="card" style="padding:16px; margin-top:16px;">
  <h3 style="margin-top:0;">Visão Operacional</h3>
  <p class="muted" style="margin-top:-6px;">Gráficos rápidos para acompanhar o fluxo de agendamentos.</p>
<div class="reports-grid">
<div class="report-card">
<h3>Agendamentos por Status</h3>
<div class="chart-container"><canvas id="statusChart"></canvas></div>
</div>
<div class="report-card">
<h3>Agendamentos por Cidade</h3>
<div class="chart-container"><canvas id="cidadeChart"></canvas></div>
</div>
<div class="report-card">
<h3>Agendamentos por Técnico</h3>
<div class="chart-container"><canvas id="tecnicoChart"></canvas></div>
</div>
<div class="report-card">
<h3>Agendamentos por Mês</h3>
<div class="chart-container"><canvas id="mesChart"></canvas></div>
</div>
</div>

</div>
</section>
<!-- Consultar Vagas Section -->
<section class="content-section" id="vagas">
<div class="section-header">
<h2>Consultar Vagas</h2>
<p>Verifique a disponibilidade de vagas por cidade e data</p>
</div>
<div class="vagas-filters">
<div class="filter-group">
<label for="vagasCidade">Cidade:</label>
<select id="vagasCidade" required=""></select>
</div>
<div class="filter-group">
<label for="vagasData">Data:</label>
<input id="vagasData" required="" type="date"/>
</div>
<button class="btn btn-primary" onclick="consultarVagas()">
<i class="fas fa-search"></i> Consultar
                </button>
</div>
<div class="vagas-result" id="vagasResult" style="display: none;"></div>
</section>
<!-- Relatórios Section -->
<section class="content-section" id="relatorios">
<div class="section-header">
<h2>Relatórios</h2>
<p>Relatório detalhado com filtros e exportação para CSV.</p>
</div>
<div class="report-filters card" style="padding:16px; margin-bottom:16px;">
  <div class="form-row" style="display:flex; gap:12px; flex-wrap:wrap; align-items:end;">
    <div style="min-width:170px;">
      <label for="repInicio">Data início</label>
      <input id="repInicio" type="date" />
    </div>
    <div style="min-width:170px;">
      <label for="repFim">Data fim</label>
      <input id="repFim" type="date" />
    </div>
    <div style="min-width:220px; flex:1;">
      <label for="repCidade">Cidade</label>
      <select id="repCidade"><option value="">Todas</option></select>
    </div>
    <div style="min-width:220px; flex:1;">
      <label for="repAssunto">Assunto</label>
      <select id="repAssunto"><option value="">Todos</option></select>
    </div>
    <div style="min-width:220px; flex:1;">
      <label for="repTecnico">Técnico</label>
      <select id="repTecnico"><option value="">Todos</option></select>
    </div>
    <div style="min-width:180px;">
      <label for="repTipo">Tipo OS</label>
      <select id="repTipo">
        <option value="">Todos</option>
        <option value="FIBRA">FIBRA</option>
        <option value="RADIO">RÁDIO</option>
      </select>
    </div>
    <div style="min-width:220px; flex:1;">
      <label for="repStatus">Status</label>
      <select id="repStatus"><option value="">Todos</option></select>
    </div>

    <button class="btn btn-primary" onclick="loadReportsDb()">
      <i class="fas fa-filter"></i> Aplicar
    </button>
    <button class="btn btn-success" id="btnExportCsv" onclick="exportReportsCsv()" disabled>
      <i class="fas fa-file-csv"></i> Exportar CSV
    </button>
  </div>
</div>

<div class="card" style="padding:16px; margin-bottom:16px;">
  <h3 style="margin-top:0;">Resumo (por cidade/técnico/assunto/status)</h3>
  <div class="table-wrap" id="repResumoWrap">
    <div class="muted">Aplique os filtros para carregar o relatório.</div>
  </div>
</div>

</section>

<!-- Auditoria Section -->
<section class="content-section" id="auditoria">
  <div class="section-header">
    <h2>Auditoria</h2>
    <p>Veja todas as ações executadas no sistema, com dados antigos e novos.</p>
  </div>

  <div class="card" style="padding:16px; margin-bottom:16px;">
    <div class="form-row" style="display:flex; gap:12px; flex-wrap:wrap; align-items:end;">
      <div style="min-width:170px;">
        <label for="audInicio">Data início</label>
        <input id="audInicio" type="date" />
      </div>
      <div style="min-width:170px;">
        <label for="audFim">Data fim</label>
        <input id="audFim" type="date" />
      </div>
      <div style="min-width:220px; flex:1;">
        <label for="audUser">Usuário</label>
        <select id="audUser"><option value="">Todos</option></select>
      </div>
      <div style="min-width:220px; flex:1;">
        <label for="audAction">Ação</label>
        <select id="audAction"><option value="">Todas</option></select>
      </div>
      <div style="min-width:220px; flex:1;">
        <label for="audEntity">Entidade</label>
        <select id="audEntity"><option value="">Todas</option></select>
      </div>
      <button class="btn btn-primary" onclick="loadAudit(1)"><i class="fas fa-filter"></i> Aplicar</button>
    </div>
  </div>

  <div class="card" style="padding:16px;">
    <div class="table-wrap" id="auditWrap">
      <div class="muted">Carregue os filtros para ver o histórico.</div>
    </div>
    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px;">
      <button class="btn" id="auditPrev" onclick="auditPageNav(-1)" disabled><i class="fas fa-chevron-left"></i> Anterior</button>
      <div class="muted" id="auditPageInfo">Página 1</div>
      <button class="btn" id="auditNext" onclick="auditPageNav(1)" disabled>Próxima <i class="fas fa-chevron-right"></i></button>
    </div>
  </div>
</section>

<!-- Gerenciar Vagas Section -->
<section class="content-section" id="gerenciarVagas">
<div class="section-header">
<h2>Gerenciar Vagas por Cidade</h2>
<p>Defina quantas vagas existem para cada assunto, por cidade, tipo de OS e período.</p>
</div>

<div class="vagas-filters">
<div class="filter-group">
<label for="gvCidade">Cidade:</label>
<select id="gvCidade"></select>
</div>
<div class="filter-group">
<label for="gvTipo">Tipo OS:</label>
<select id="gvTipo"></select>
</div>
<div class="filter-group">
<label for="gvPeriodo">Período:</label>
<select id="gvPeriodo">
<option value="MANHÃ">MANHÃ</option>
<option value="TARDE">TARDE</option>
</select>
</div>
<button class="btn btn-primary" onclick="carregarVagasTemplates()">
<i class="fas fa-download"></i> Carregar
</button>
<button class="btn btn-success" onclick="salvarVagasTemplates()" id="gvSalvarBtn" disabled>
<i class="fas fa-save"></i> Salvar
</button>
</div>

<div id="gvTabelaWrap" style="display:none;"></div>
</section>

<!-- Gerenciar Assuntos Section -->
<section class="content-section" id="assuntos">
<div class="section-header">
<h2>Gerenciar Assuntos</h2>
<p>Crie, renomeie ou desative assuntos usados em OS, agenda e consulta de vagas.</p>
</div>

<div class="card" style="padding:16px;">
<div class="form-row" style="display:flex; gap:12px; flex-wrap:wrap; align-items:end;">
<div style="min-width:260px; flex:1;">
<label for="novoAssunto">Novo assunto</label>
<input id="novoAssunto" type="text" placeholder="Ex: Conexão lenta" />
</div>
<button class="btn btn-primary" onclick="criarAssunto()"><i class="fas fa-plus"></i> Criar</button>
</div>

<div style="margin-top:16px;" id="listaAssuntos"></div>
</div>
</section>
</main>
<!-- Toast Notifications -->
<div class="toast-container" id="toastContainer"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="scripts.js"></script>
</body>
</html>
